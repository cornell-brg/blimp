

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sequence Numbers &mdash; Blimp  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/logo.css?v=0320fe47" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/wavedrom.css?v=4f1d019f" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/table.css?v=09be579f" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/image.css?v=c42c1b78" />

  
    <link rel="shortcut icon" href="../../_static/blimp_favicon.png"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=187304be"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="https://wavedrom.com/skins/default.js"></script>
      <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../" class="icon icon-home">
            Blimp
              <img src="../../_static/blimp_no_border.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/motivation/">Design Motivation and Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/data_flow/">Data Flow in the Processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/versions/">Processor Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/repository_structure/">Repository Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/build_system/">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/dependencies/">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/todo/">Further Work</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Level (FL) Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fl/assembler/">Assembler and Disassembler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fl/proc/">Functional-Level Processor</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FPGA Implementation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/peripherals/">Memory-Mapped Peripherals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/network/">Memory Network</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Demonstrations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../demos/sim_demo/">Modifying Blimp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../demos/quartus_demo/">Colossal Cave Demo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">Blimp</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Sequence Numbers</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/cornell-brg/blimp/blob/main/docs/uarch/seq_nums.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="sequence-numbers">
<h1>Sequence Numbers<a class="headerlink" href="#sequence-numbers" title="Link to this heading"></a></h1>
<p>As part of the modular, out-of-order architecture, Blimp needs a way to
keep track of a global ordering between instructions. This is used to
reorder instructions in the WCU, as well as to compare ages of
instructions in the event of a squash.</p>
<p>This is implemented through the use of <em>sequence numbers</em>. Each
instruction is allocated a sequence number in the FU. This number
follows the instruction throughout the pipeline, and is used in the WCU
to reorder instructions. Once the instruction commits, the sequence
number is freed, and can be used again.</p>
<p>To understand sequence numbers, consider them as a range of values; in
this case, 0 - 7. The FU (responsible for allocating and freeing numbers)
can store these as an array; for any given number, a value of <code class="docutils literal notranslate"><span class="pre">1</span></code> at
that index indicates that the number is allocated, and a <code class="docutils literal notranslate"><span class="pre">0</span></code> indicates
that it’s free.</p>
<a class="bottompadding reference internal image-reference" href="../../_images/seq_nums.png"><img alt="A picture of linearly-organized sequence numbers" class="bottompadding align-center" src="../../_images/seq_nums.png" style="width: 70%;" />
</a>
<p>In this example, the sequence numbers <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">3</span></code>, and <code class="docutils literal notranslate"><span class="pre">4</span></code> are
allocated to in-flight instructions. This array acts as a FIFO buffer:</p>
<ul class="simple">
<li><p>When we allocate a sequence number, we allocate the entry that <code class="docutils literal notranslate"><span class="pre">head</span></code>
points to. The corresponding entry is set to <code class="docutils literal notranslate"><span class="pre">1</span></code>, and the <code class="docutils literal notranslate"><span class="pre">head</span></code>
pointer increments</p></li>
<li><p>When a sequence number is freed, the corresponding entry is set to <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">tail</span></code> pointer indicates the oldest in-flight sequence number.
When that entry is freed, <code class="docutils literal notranslate"><span class="pre">tail</span></code> can increment.</p></li>
</ul>
<p>To avoid overlap, we can’t allow <code class="docutils literal notranslate"><span class="pre">head</span></code> to increment enough to reach
<code class="docutils literal notranslate"><span class="pre">tail</span></code>; in this case, the allocation must wait until <code class="docutils literal notranslate"><span class="pre">tail</span></code>
increments.</p>
<section id="age-logic">
<h2>Age Logic<a class="headerlink" href="#age-logic" title="Link to this heading"></a></h2>
<p>Since we know where <code class="docutils literal notranslate"><span class="pre">tail</span></code> is, we can also determine the relative age of
each sequence number. Let’s first consider the case where both sequence
numbers are on the same “side” of the <code class="docutils literal notranslate"><span class="pre">tail</span></code> pointer:</p>
<a class="bottompadding reference internal image-reference" href="../../_images/seq_nums_age_simple.png"><img alt="A number line of sequence numbers" class="bottompadding align-center" src="../../_images/seq_nums_age_simple.png" style="width: 50%;" />
</a>
<p>Here, the comparison is simple; the older sequence number is the lesser
one (closest to the tail):</p>
<div class="highlight-sv notranslate"><div class="highlight"><pre><span></span><span class="k">assign</span><span class="w"> </span><span class="mi">0_</span><span class="n">is_older</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">seq_num_0</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">seq_num_1</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<p>However, let’s now consider the case where sequence numbers wrap-around
(a.k.a. one sequence number is less than <code class="docutils literal notranslate"><span class="pre">tail</span></code>, indicating we’ve
started allocating below where we’re freeing):</p>
<a class="bottompadding reference internal image-reference" href="../../_images/seq_nums_age_wrap.png"><img alt="A number line of sequence numbers with wraparound" class="bottompadding align-center" src="../../_images/seq_nums_age_wrap.png" style="width: 50%;" />
</a>
<p>Here, the comparison should be reversed; the lesser sequence number is
now younger, since it is less than <code class="docutils literal notranslate"><span class="pre">tail</span></code>. The comparison should be
flipped for each sequence number that is less than the tail:</p>
<div class="highlight-sv notranslate"><div class="highlight"><pre><span></span><span class="k">assign</span><span class="w"> </span><span class="mi">0_</span><span class="n">is_older</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">seq_num_0</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">seq_num_1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">^</span>
<span class="w">                    </span><span class="p">(</span><span class="w"> </span><span class="n">seq_num_0</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tail</span><span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="o">^</span>
<span class="w">                    </span><span class="p">(</span><span class="w"> </span><span class="n">seq_num_1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tail</span><span class="w">      </span><span class="p">);</span>
</pre></div>
</div>
<p>Credit: <a class="reference external" href="https://github.com/riscv-boom/riscv-boom/blob/7184be9db9d48bd01689cf9dd429a4ac32b21105/src/main/scala/v3/util/util.scala#L363">SonicBOOM</a></p>
</section>
</section>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Aidan McNay.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>